(function(t){function e(t){if(t.rockets.length<o){var e=new a(t);t.rockets.push(e)}}function s(t){e(t),t.canvas_width!=t.element.offsetWidth&&(t.canvas_width=t.canvas.width=t.canvas_buffer.width=t.element.offsetWidth),t.canvas_height!=t.element.offsetHeight&&(t.canvas_height=t.canvas.height=t.canvas_buffer.height=t.element.offsetHeight),t.context_buffer.clearRect(0,0,t.canvas.width,t.canvas.height),t.context_buffer.globalAlpha=.9,t.context_buffer.drawImage(t.canvas,0,0),t.context.clearRect(0,0,t.canvas.width,t.canvas.height),t.context.drawImage(t.canvas_buffer,0,0);var s=[];t.rockets.forEach(function(e){e.update(),e.render(t.context);var i=e.pos.y<2*t.canvas.height/3&&100*Math.random()<=1;e.pos.y<t.canvas.height/5||e.vel.y>=0||i?e.explode(t):s.push(e)}),t.rockets=s;var i=[];for(t.particles.forEach(function(e){e.update(),e.exists()&&(e.render(t.context),i.push(e))}),t.particles=i;t.particles.length>h;)t.particles.shift()}function i(t){this.pos={x:t?t.x:0,y:t?t.y:0},this.vel={x:0,y:0},this.shrink=.97,this.size=2,this.resistance=1,this.gravity=0,this.flick=!1,this.alpha=1,this.fade=0,this.color=0}function a(t){i.apply(this,[{x:Math.random()*t.canvas.width*2/3+t.canvas.width/6,y:t.canvas.height}]),this.explosionColor=10*Math.floor(360*Math.random()/10),this.vel.y=-3*Math.random()-4,this.vel.x=6*Math.random()-3,this.size=2,this.shrink=.999,this.gravity=.01}var o=2,h=1e3,r={init:function(e){var i=t(e);if(void 0===i.data("fireworks_data")){var a=document.createElement("canvas"),o=document.createElement("canvas"),h={element:e,canvas:a,context:a.getContext("2d"),canvas_buffer:o,context_buffer:o.getContext("2d"),particles:[],rockets:[]};"static"===i.css("position")&&(e.style.position="relative"),e.appendChild(a),a.style.position="absolute",a.style.top="0px",a.style.bottom="0px",a.style.left="0px",a.style.right="0px",h.interval=setInterval(s.bind(this,h),20),i.data("fireworks_data",h)}else console.log("Looks like this element is already inited!")},destroy:function(e){var s=t(e);if(void 0!==s.data("fireworks_data")){var i=s.data("fireworks_data");s.removeData("fireworks_data"),clearInterval(i.interval),i.canvas.remove(),i.element.style.position=""}else console.log("Looks like this element is not yet inited!")}};t.fn.fireworks=function(t){return t||(t="init"),this.each(function(){r[t](this)}),this},i.prototype.update=function(){this.vel.x*=this.resistance,this.vel.y*=this.resistance,this.vel.y+=this.gravity,this.pos.x+=this.vel.x,this.pos.y+=this.vel.y,this.size*=this.shrink,this.alpha-=this.fade},i.prototype.render=function(t){if(this.exists()){t.save(),t.globalCompositeOperation="lighter";var e=this.pos.x,s=this.pos.y,i=this.size/2,a=t.createRadialGradient(e,s,.1,e,s,i);a.addColorStop(.1,"rgba(255,255,255,"+this.alpha+")"),a.addColorStop(.8,"hsla("+this.color+", 100%, 50%, "+this.alpha+")"),a.addColorStop(1,"hsla("+this.color+", 100%, 50%, 0.1)"),t.fillStyle=a,t.beginPath(),t.arc(this.pos.x,this.pos.y,this.flick?Math.random()*this.size:this.size,0,2*Math.PI,!0),t.closePath(),t.fill(),t.restore()}},i.prototype.exists=function(){return this.alpha>=.1&&this.size>=1},a.prototype=new i,a.prototype.constructor=a,a.prototype.explode=function(t){for(var e=10*Math.random()+80,s=0;s<e;s++){var a=new i(this.pos),o=Math.random()*Math.PI*2,h=15*Math.cos(Math.random()*Math.PI/2);a.vel.x=Math.cos(o)*h,a.vel.y=Math.sin(o)*h,a.size=10,a.gravity=.2,a.resistance=.92,a.shrink=.05*Math.random()+.93,a.flick=!0,a.color=this.explosionColor,t.particles.push(a)}},a.prototype.render=function(t){if(this.exists()){t.save(),t.globalCompositeOperation="lighter";var e=this.pos.x,s=this.pos.y,i=this.size/2,a=t.createRadialGradient(e,s,.1,e,s,i);a.addColorStop(.1,"rgba(255, 255, 255 ,"+this.alpha+")"),a.addColorStop(.2,"rgba(255, 180, 0, "+this.alpha+")"),t.fillStyle=a,t.beginPath(),t.arc(this.pos.x,this.pos.y,this.flick?Math.random()*this.size/2+this.size/2:this.size,0,2*Math.PI,!0),t.closePath(),t.fill(),t.restore()}}})(jQuery);